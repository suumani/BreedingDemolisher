# Breeding Demolisher — 仕様書（spec）

本書は Breeding Demolisher の **設計意図・仕様・合意事項** を記録するためのドキュメントである。  
Mod Portal / README では説明しきれない「判断基準」「仕様の優先順位」「バグと仕様の境界」を保持することを目的とする。

---

## 0. 目的と非目的

### 0.1 目的（Purpose）
- デモリッシャーを「単発の脅威」ではなく、**増殖する生態系（Ecosystem）**として扱う体験を提供する
- 放置すると脅威が増大する一方で、**上限・制御ロジック**によりゲームが破綻しない範囲に収める
- 高密度戦闘・封じ込め・資源配分（討伐／放置／飼育）の意思決定を発生させる

### 0.2 非目的（Non-goals）
- 常にプレイヤーが安全に管理できる難易度を保証しない
- 卵・繁殖を「単なる収集要素」にしない（放置の代償を必ず残す）
- グローバルな敵挙動を全面的に置換することは目的としない

---

## 1. Mod の位置づけ
- 分類：コンテンツ追加 / Enemies
- 対象：Factorio 2.0（Space Age）
- コア体験：増殖するデモリッシャーを「狩る／放置する／飼う」で管理する

---

## 2. 基本ループ
1. 時間経過や戦闘により卵が生成される
2. 卵が孵化し、個体数が増える
3. 個体数増加が圧力となり、防衛・討伐・移動制御が必要になる
4. プレイヤーは「封じ込め／間引き／飼育」を選ぶ

---

## 3. 自然繁殖（Wild）
- デモリッシャーは一定間隔で繁殖し、卵が生成される
- 卵は一定時間で孵化する
- 総個体数には上限がある（cap）
- 増殖は「現在数」と「上限」に基づき制御される
- 撃破時、稀に卵をドロップする
- 進化度に応じて：
  - 孵化個体が高品質になる場合がある
  - 卵の拡散範囲が拡大する
- 総個体数の上限：
  - **200 固定**とする（パフォーマンス安定性を最優先）
- 1回の増殖処理で生成される卵数にも上限を設ける（スパイク防止）

---

## 4. プレイヤー介入・ペット
- 野生撃破で卵を得られる場合がある
- 卵から孵化した個体は「ペット」として扱われる
- ペットは性質（敵対／中立／友好）を持つ
- 成熟したペットは繁殖を開始し、卵を産む
- 子孫は親の特徴・能力を引き継ぐ場合がある
- 繁殖で生まれた卵は、ドロップ卵より高品質になりやすい

---

## 5. 難易度・圧力設計
- 本 Mod は「高リスク・高密度戦闘」を好むプレイヤー向けである
- 早期の理不尽さを避けつつ、**放置が危険になる圧力**を維持する
- 進行に応じて以下が段階的に強化される：
  - 個体品質
  - 繁殖成功率
  - 拡散・移動圧力

---

## 6. 移動挙動と圧力の拡散

### 6.1 移動対象の基本方針
- Breeding Demolisher Mod が扱う移動対象は以下に限定される：
  - **manis-small / manis-medium / manis-big**
- Gigantic 系・King 系は本 Mod の移動制御対象外である
- 移動対象の抽選は、専用の MovePlanner / Executor により制御される

### 6.2 定期移動（通常）
- 移動処理は **約1分に1回**の周期で評価される
- 移動は「圧力の分散」と「戦線の変遷」を目的とする
- 移動先は、生成済みチャンク範囲を基準に決定される

### 6.3 密集掃除（過去データ汚染対策）

- 過去の Mod により、**default デモリッシャーが意図せず一地域に高密度で存在する**
  セーブデータが存在する
- これらは当時の仕様に基づく挙動であり、品質（normal / non-normal）による区別は行われていなかった
- 本 Mod では、これらを「バグ修正」ではなく、
  **生態系の是正（cleanup）**として扱う

#### 掃除ルール
- 対象：
  - **default デモリッシャー**
  - **品質によるフィルタは行わない**
- 方法：
  - 毎回すべてを走査せず、**ランダムに少数（例：最大5体）をサンプル**
  - サンプル個体の周囲一定半径（例：50タイル）に
    一定数以上（例：5体以上）が存在した場合、
    その地域を「異常密集」と判定
- 効果：
  - 異常密集が検出された場合、
    **その密集地からランダムで1体のみ**を移動対象として追加する
- 制約：
  - 掃除による追加移動は **1回の評価につき最大1体**
  - パフォーマンス安定性を最優先し、軽量な判定を採用する

---

## 7. ロケット発射への反応（振動特性）
- ゲーム中盤以降、ロケットが発射されると、
  デモリッシャーは一定サイクル内で徐々にサイロへ向かう
- これは「活動（振動）への嫌悪」という特性として表現される

---

## 8. 決定性・マルチプレイ
- 乱数は deterministic な手法を用い、マルチプレイでの再現性を前提とする
- RNG は Mod 内で一元管理される
- 再現性に問題が見つかった場合は **バグとして扱う**

---

## 9. セーブデータ
- 使用するグローバルデータ：`storage` 配下（キーは実装に準拠）
- データ移行が必要な変更を行う場合は、更新手順を明記する

---

## 10. 本 spec の扱い
- 本書は README および Mod Portal の記述より優先される
- 実装と乖離が生じた場合：
  - 実装を仕様とみなすか
  - spec を更新するか
  を明示的に判断する
